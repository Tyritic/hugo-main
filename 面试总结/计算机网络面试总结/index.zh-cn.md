---
date : '2025-03-23T20:55:17+08:00'
draft : false
title : '计算机网络面试总结'
image : ""
categories : ["计算机网络"]
tags : ["计算机基础"]
description : "计算机网络常见面试题"
math : true
---

## TCP协议

### TCP协议是如何保证可靠传输的，有哪些机制？

TCP协议主要通过以下几点来保证传输可靠性：连接管理、序列号、确认应答、超时重传、流量控制、拥塞控制。

- **连接管理** ：即三次握手和四次挥手。连接管理机制能够建立起可靠的连接，这是保证传输可靠性的前提。
- **序列号** ：TCP将每个字节的数据都进行了编号。序列号能够保证可靠性，接收方可以根据序列号判断数据是否丢失或乱序。既能防止数据丢失，又能避免数据重复。基于序列号可实现多次发送，一次确认。
- **确认应答** ：接收方接收数据之后，会回传ACK报文，报文中带有此次确认的序列号，用于告知发送方此次接收数据的情况。在指定时间后，若发送端仍未收到确认应答，就会启动超时重传。
- **重传机制** ：重传机制主要有两种场景
  - 数据包丢失：在指定时间后，若发送端仍未收到确认应答，就会启动超时重传，向接收端重新发送数据包。
  - 确认包丢失：当发送方连续收到多个相同的 ACK（表明后续数据丢失）时，会立即重传缺失的数据，而不必等待超时发生，从而提高传输效率。

- **流量控制** ：接收端处理数据的速度是有限的，如果发送方发送数据的速度过快，就会导致接收端的缓冲区溢出，进而导致丢包。为了避免上述情况的发生，TCP支持根据接收端的处理能力，来决定发送端的发送速度。流量控制是通过在TCP报文段首部维护一个滑动窗口来实现的。
- **拥塞控制** ：拥塞控制就是当网络拥堵严重时，发送端减少数据发送。拥塞控制是通过发送端维护一个拥塞窗口来实现的。可以得出，发送端的发送速度，受限于滑动窗口和拥塞窗口中的最小值。拥塞控制方法分为：慢开始，拥塞避免、快重传和快恢复。
- **校验和** ：TCP报文头有校验和，用于校验报文是否损坏。接收方计算接收到数据的校验和，并与报文中的校验和进行比较，确保数据完整性。如果校验失败，则会丢弃该段数据，并期望发送方通过重传机制恢复数据。

### 什么是TCP粘包？

#### 现象解释

TCP 粘包是指在 TCP 协议传输数据时，出现的一种数据粘连、边界不清晰的现象，就可能导致数据解析错误。例如，原本应该是两个独立的消息，由于粘包现象，接收方可能将这两个消息当作一个消息来解析，从而导致登录信息和查询信息混乱，无法正确处理用户的请求。

#### 出现原因

粘包的问题出现是因为不知道一个用户消息的边界在哪，如果知道了边界在哪，接收方就可以通过边界来划分出有效的用户消息。

#### 解决方案

- **固定长度的消息** ：类似UDP的做法
- **特殊字符作为边界** ：在两个用户消息之间插入一个特殊的字符串，这样接收方在接收数据时，读到了这个特殊字符，就把认为已经读完一个完整的消息。
  - HTTP 通过设置回车符、换行符作为 HTTP 报文协议的边界。
- **自定义消息结构**

### tcp场景：发送端发seq=11，12，13，接收端只收到11，13，接收端回复什么信息。

假设发送端依次发送三个数据包，其序列号分别为 11、12、13，而接收端只收到 seq=11 和 seq=13，这意味着 seq=12 丢失了。TCP 是累积确认（cumulative acknowledgment）的协议，接收端只确认连续正确接收到的数据。

接收端的行为：当接收端收到 seq=11 后，下一步它期望收到 seq=12；如果收到 seq=13（但 seq=12 丢失），接收端发现数据出现空洞，仍然会回复 ACK=12（表示“我还在等待从 12 开始的数据”）。 此外，收到乱序数据时，接收端会发送重复 ACK，也就是多次回复 ACK=12，以通知发送端缺失的部分。

### 超时重传与快速重传

- **超时重传**
  - 发送端为每个发送出去的数据段启动一个定时器，如果在预定时间内没有收到相应的 ACK，发送端认为该段丢失，便重新发送该数据段。
  - 超时重传的时间间隔是动态计算的，通常依赖于往返时间（RTT）的估算以及 RTT 的偏差，以适应网络延迟的变化。
- **快速重传**
  - 当发送端连续收到三个或更多相同的 ACK（即重复 ACK），说明接收端已经收到后续的数据包，但缺失的数据包一直没有到达。
  - 发送端就会认为丢失的数据段很可能已经丢失，于是不等待超时，立即进行重传，这样可以更快地恢复数据连续性，提高传输效率。

### TCP 滑动窗口概念与初始大小调整

#### 滑动窗口概念

- 滑动窗口机制用于控制发送方一次可以发送多少字节的数据而无需等待确认。它帮助平衡发送速率和接收方处理能力，避免接收端缓冲区溢出。
- 接收窗口（rwnd）： 由接收端根据自身缓冲区大小通告给发送方。
- 拥塞窗口（cwnd）： 由发送端根据网络拥塞状况调整。 发送方可发送的数据量为 `min(rwnd, cwnd)`。

#### 滑动窗口初始大小

- 初始拥塞窗口（初始 cwnd）：
  - 通常由操作系统 TCP/IP 栈决定，而现代系统多采用 10 个 MSS（参考 RFC 6928）作为默认值。
- 接收窗口（rwnd）：
  - 由接收端根据自己的接收缓冲区大小确定，应用程序可以通过 socket 接口设置缓冲区大小。

## HTTP协议

### 发送http请求的过程

- DNS 解析：客户端（浏览器或其他 HTTP 客户端）通过 DNS 解析将 URL 中的域名转换成服务器的 IP 地址。

- 建立 TCP 连接：客户端与服务器之间建立 TCP 连接。这通常涉及三次握手过程：

  - 客户端发送 SYN 包；
  - 服务器响应 SYN+ACK；
  - 客户端再发送 ACK 确认，连接建立。

- 发送 HTTP 请求：TCP 连接建立后，客户端构造 HTTP 请求报文，包含请求方法（GET、POST 等）、请求 URI、HTTP 版本、请求头（Header）和可选的请求体（Body）。请求报文被发送到服务器。

- 服务器处理请求：

  - 服务器接收到 HTTP 请求后，根据 URI、请求头、请求体等信息进行路由和业务处理。

  - 生成响应报文，包含状态行、响应头和响应体。

- 返回 HTTP 响应：

  - 服务器通过 TCP 连接将响应数据发送回客户端。

  - 客户端接收到响应后，解析响应头和响应体，进行后续处理（如呈现页面、解析 JSON 数据等）。

- 关闭连接或保持连接：

  - 根据 HTTP 协议版本和应用场景，TCP 连接可能会被复用或关闭。

## HTTPS协议

### **HTTPS相对于HTTP有什么优势？**

- **HTTPS 使用 SSL/TLS 协议对数据进行加密** ：相较于HTTP协议明文传输，在数据传输过程中，数据会被加密成一串乱码，只有合法的接收方才能使用相应的密钥将其解密还原为原始数据。这就防止了数据在传输过程中被窃取或篡改，保护了用户的隐私和数据安全。

- **HTTPS 要求服务器拥有由权威证书颁发机构颁发的数字证书** ：客户端在与服务器建立连接时，会验证服务器的证书，以确保连接的服务器是真实可靠的，而不是假冒的。这可以有效防止用户访问到钓鱼网站，避免用户的账号、密码等信息被窃取。

- **HTTPS 通过数字签名等技术来确保数据的完整性** ：在数据传输过程中，一旦数据被篡改，接收方就可以通过验证数字签名发现数据的变化，从而拒绝接受被篡改的数据，保证数据的准确性和完整性。

### **HTTP存在哪些安全问题，HTTPS通过什么机制解决安全问题？**

HTTP 由于是明文传输，所以安全上存在以下三个风险：

- **窃听风险** ：通信链路上可以获取通信内容，用户号容易没。
- **篡改风险** ：强制植入垃圾广告，视觉污染。
- **冒充风险** ：比如冒充知名网站

HTTPS则通过SSL/TLS 协议，可以解决了上述的风险

- **信息加密**：交互信息无法被窃取
- **校验机制**：无法篡改通信内容
- **身份证书** ：证明网站的真实性

### HTTPS的TLS四次握手

- **ClientHello（客户端问候）** ：客户端发送 ClientHello 消息，其中包含支持的 TLS 协议版本、加密套件列表、压缩方法、随机数（client_random）信息。表示客户端向服务端请求加密通信
- **ServerHello（服务器问候）** ：服务器回复 ServerHello 消息，确定使用的 TLS 版本、加密套件、压缩方法，服务器的数字证书并发送服务器的随机数（server_random）。
- **客户端回应** ：通过浏览器或者操作系统中的 CA 公钥，确认服务器的数字证书的真实性。同时生成会话密钥： 客户端使用客户端随机数，服务器随机数和 **`pre_master_key`** 这三个随机数进行计算得到一个 **会话秘钥** 。客户端会 **从数字证书中取出服务器的公钥** ，然后使用它加密报文的 **`pre-master key`** ，向服务器发送如下信息：
  - 一个随机数 **`（pre-master key）`** ：该随机数由客户端生成，并被服务器公钥加密。
  - 加密通信算法改变通知：表示随后的信息都将用会话秘钥加密通信。
  - 内容摘要：客户端会把迄今为止的通信数据内容生成一个摘要，用 **会话秘钥** 加密，发给服务器做校验，此时客户端这边的握手流程就结束了，因此也叫 **Finished报文** 。
- **服务端回应** ：服务器收到客户端的第三个随机数 **`（pre-master key）`** 之后，通过协商的加密算法，计算出本次通信的 **会话秘钥** 。
  - 加密通信算法改变通知，表示随后的信息都将用会话秘钥加密通信。
  - 服务器握手结束通知，表示服务器的握手阶段已经结束。这一项同时把之前所有内容的发生的数据做个摘要，用来供客户端校验。

## 登录鉴权机制

### 会话如何记录用户的状态信息

HTTP 协议本身是无状态的，即每个请求都是独立的，不保留前后关联。

- Session（会话）：

- - 服务器在用户首次登录或访问时生成一个唯一的 Session ID，并将其保存在服务器端的会话存储中（如内存、数据库或分布式缓存）。
  - Session ID 通常通过 Cookie（如 `Set-Cookie: JSESSIONID=...`）传回客户端，后续请求中客户端自动带上该 Cookie，服务器根据 Session ID 关联用户状态信息。

- Token 机制（如 JWT）：

- - 在用户认证后，由服务器生成一个令牌（Token），其中包含用户身份信息、权限、过期时间等，经过数字签名确保完整性。
  - 客户端将该 Token 保存（例如 localStorage 或 Cookie 中），每次请求时在 HTTP Header 中带上服务器验证 Token 后即可获得用户状态。

- 其他方式：使用 OAuth 等协议，通过访问令牌来维持用户会话状态。

### 为什么用了 HTTPS 还需要 Session/Token？

虽然 HTTPS 提供了传输层的加密和数据完整性保障，但它只负责在客户端和服务器之间建立安全的通信通道。

- HTTP 本身无状态：HTTPS 只保证数据传输过程中的安全，无法解决 HTTP 协议无状态的问题。无论是 HTTP 还是 HTTPS，每个请求在协议层面都是独立的，服务器需要额外机制来识别同一个用户的连续请求。
- 用户认证与授权：会话机制（Session/Token）用于记录用户的登录状态、权限信息以及业务相关的状态数据。这样，服务器可以根据请求中的 Session ID 或 Token 确定用户身份，执行相应的业务逻辑。
- 防止重放：Token 机制（如 JWT）可以内嵌过期时间、签名等信息，帮助防止重放攻击，同时结合其它防护机制可以减少 CSRF 等安全问题。HTTPS 保护的是传输过程，而 Token 则用于业务层面的认证和授权。
- 分布式环境的状态管理：在微服务架构中，不同服务可能需要共享用户状态信息，Token（特别是自包含的 JWT）能够方便地在各服务间传递并验证用户身份，HTTPS 无法提供这类应用层数据管理功能。
